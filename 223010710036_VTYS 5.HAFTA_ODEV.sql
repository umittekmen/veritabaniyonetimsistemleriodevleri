CREATE DATABASE OKUL_KUTUPHANESI;

USE OKUL_KUTUPHANESI

CREATE TABLE UYELER(
	UYE_NO INT IDENTITY(1,1),
	UYE_ADI VARCHAR(20),
	UYE_SOYADI VARCHAR(20),
	CINSIYET VARCHAR(5),
	TELEFON VARCHAR(15),
	EPOSTA VARCHAR(40),
	ADRES_NO INT,
	PRIMARY KEY("UYE_NO")
);

ALTER TABLE UYELER ADD CONSTRAINT "ADRESLER_UYELER" 
FOREIGN KEY (ADRES_NO) REFERENCES ADRESLER(ADRES_NO);

CREATE TABLE ADRESLER(
	ADRES_NO INT IDENTITY(1,1),
	CADDE VARCHAR(20),
	MAHALLE VARCHAR(20),
	BINA_NO VARCHAR(20),
	SEHIR VARCHAR(20),
	POSTA_KODU INT, 
	ULKE VARCHAR(20),
	PRIMARY KEY ("ADRES_NO")
);


CREATE TABLE EMANET(
	EMANET_NO INT IDENTITY(1,1),
	ISBN VARCHAR(20) NOT NULL,
	UYE_NO INT NOT NULL,
	KUTUPHANE_NO INT NOT NULL,
	EMANET_TARIHI DATETIME,
	TESLIM_TARIHI DATETIME,
	PRIMARY KEY ("EMANET_NO")
);

CREATE TABLE KITAPLAR(
	ISBN VARCHAR(20),
	KITAP_ADI VARCHAR(20),
	YAYIN_TARIHI VARCHAR(20),
	S_SAYISI INT,
	PRIMARY KEY ("ISBN")
);

CREATE TABLE YAZARLAR(
	YAZAR_NO INT IDENTITY(1,1),
	YAZAR_ADI VARCHAR(20),
	YAZAR_SOYADI VARCHAR(20),
	PRIMARY KEY ("YAZAR_NO")
);

CREATE TABLE KATEGORILER(
	KATEGORI_NO INT IDENTITY(1,1),
	KATEGORI_ADI VARCHAR(20),
	PRIMARY KEY ("KATEGORI_NO")
);

CREATE TABLE KUTUPHANE(
	KUTUPHANE_NO INT IDENTITY(1,1),
	KUTUPHANE_ADI VARCHAR(20),
	ACIKLAMA VARCHAR(20),
	ADRES_NO INT,
	PRIMARY KEY ("KUTUPHANE_NO")
);

CREATE TABLE KITAP_KUTUPHANE(
	KUTUPHANE_NO INT NOT NULL,
	ISBN VARCHAR(20) NOT NULL,
	MIKTAR INT,
	CONSTRAINT "KITAP_KUTUPHANE_PK" PRIMARY KEY ("KUTUPHANE_NO", "ISBN"),
	CONSTRAINT "KITAP_KUTUPHANE_FK" FOREIGN KEY ("KUTUPHANE_NO") REFERENCES KATEGORILER(KATEGORI_NO)

);

ALTER TABLE KITAP_KUTUPHANE ADD CONSTRAINT "KITAP_KUTUPHANE_KITAPLAR_FK" FOREIGN KEY ("ISBN") REFERENCES KITAPLAR(ISBN);


CREATE TABLE KITAP_KATEGORI(
	ISBN VARCHAR(20) NOT NULL,
	KATEGORI_NO INT NOT NULL,
	CONSTRAINT "KITAP_KATEGORI_PK" PRIMARY KEY ("KATEGORI_NO", "ISBN")
);

CREATE TABLE KITAP_YAZAR(
	ISBN VARCHAR(20) NOT NULL,
	YAZAR_NO INT NOT NULL,
	CONSTRAINT "KITAP_YAZAR_PK" PRIMARY KEY ("YAZAR_NO", "ISBN")
);


---KUTUPHANE
USE OKUL_KUTUPHANESI;
ALTER TABLE KUTUPHANE ADD CONSTRAINT "ADRESLER_KUTUPHANE" 
FOREIGN KEY (ADRES_NO) REFERENCES ADRESLER(ADRES_NO)
ON DELETE SET NULL
ON UPDATE CASCADE;

--- EMANET

USE OKUL_KUTUPHANESI;
ALTER TABLE EMANET ADD CONSTRAINT "UYELER_EMANET" 
FOREIGN KEY (UYE_NO) REFERENCES UYELER(UYE_NO);

USE OKUL_KUTUPHANESI;
ALTER TABLE EMANET ADD CONSTRAINT "EMANET_KITAPLAR" 
FOREIGN KEY (ISBN) REFERENCES KITAPLAR(ISBN);

USE OKUL_KUTUPHANESI;
ALTER TABLE EMANET ADD CONSTRAINT "KUTUPHANE_EMANET" 
FOREIGN KEY (KUTUPHANE_NO) REFERENCES KUTUPHANE(KUTUPHANE_NO);

---KITAP_KATEGORI
USE OKUL_KUTUPHANESI;
ALTER TABLE KITAP_KATEGORI ADD CONSTRAINT KATEGORILER_KITAP_KATEGORI
FOREIGN KEY (KATEGORI_NO) REFERENCES KATEGORILER(KATEGORI_NO);

USE OKUL_KUTUPHANESI;
ALTER TABLE KITAP_KATEGORI ADD CONSTRAINT KITAPLAR_KITAP_KATEGORI
FOREIGN KEY (ISBN) REFERENCES KITAPLAR(ISBN);

---KITAP_YAZAR
USE OKUL_KUTUPHANESI;
ALTER TABLE KITAP_YAZAR ADD CONSTRAINT YAZARLAR_KITAP_YAZAR
FOREIGN KEY (YAZAR_NO) REFERENCES YAZARLAR(YAZAR_NO);

USE OKUL_KUTUPHANESI;
ALTER TABLE KITAP_YAZAR ADD CONSTRAINT KITAPLAR_KITAP_YAZAR
FOREIGN KEY (ISBN) REFERENCES KITAPLAR(ISBN);

---KITAP_KUTUPHANE
USE OKUL_KUTUPHANESI;
ALTER TABLE KITAP_KUTUPHANE ADD CONSTRAINT KUTUPHANE_KITAP_KUTUPHANE
FOREIGN KEY (KUTUPHANE_NO) REFERENCES KUTUPHANE(KUTUPHANE_NO);

USE OKUL_KUTUPHANESI;
ALTER TABLE KITAP_KUTUPHANE ADD CONSTRAINT KITAPLAR_KITAP_KUTUPHANE
FOREIGN KEY (ISBN) REFERENCES KITAPLAR(ISBN);


USE OKUL_KUTUPHANESI
INSERT INTO ADRESLER
VALUES('Orhanhazi','Esentepe','5','Tokat','60100','Türkiye');
INSERT INTO ADRESLER
VALUES('Sivas','Kemer','34','Tokat','60100','Türkiye'),	
		(NULL,'Evrenköy','21','Tokat','60400','Türkiye');

	INSERT INTO ADRESLER
	values
	(Null,'Cumhuriyet','56','Tokat','60300','Türkiye'),
	('Atatürk','Barbaros','142','Ýstanbul','34200',	'Türkiye'),
	('C.Gürsel'	,'Tuna'	,'65','Ýzmir','35600','Türkiye'),
	('Sipahi','Þamlar',	'85','Amasya','5200','Türkiye'),
	(Null,'Kýzýlay','114','Ankara','6400','Türkiye');
	
	USE OKUL_KUTUPHANESI
	INSERT INTO UYELER
	VALUES 
	('Ayþe', 'Kara', 0,'35612345562', 'aa@mail.com',1);
 
	 INSERT INTO UYELER
		VALUES ('Ali', 'Uçar', 1,'3562345667', 'au@abc.com',3),
		('Ahmet','Davut',1, '3563456778', 'ad@mail.com',2),
		('Murat', 'Sönmez',1, '3564566789','ms@krh.com',1),
		('Burak' ,'Torun' ,1, '3565678997', 'bt@mail2.com',7),
		('Ayla', 'Yýlmaz',0,'5111254584','ay@m3.com',5),
		('Mustafa','Demir',1,'4441257898','md@mail.com' ,6),
		('Turgut','Özseven',1,'3584587125',	'to@md4.com',4),
		('Elif','Uymaz',0,'3124789520','eu@md4.com',8);

	USE OKUL_KUTUPHANESI
INSERT INTO KITAPLAR
VALUES
('6051961436','Sembollerveisaretler','2010-02-02','352'),
('6053950899','türk eðitim ve tarih','2010-01-01','262'),
('6053953135','geliþimvepsikolojisi','2010-01-01','290'),
('6054125234','zazalarvetürklük','2010-01-01','264'),
('6055813185','þifreler','2009-08-03','288'),
('6055882334','28 gündekuantum','2009-08-03','248'),
('6055937065','bigisayarlýmuhasebe','2009-04-05','358'),
('6055937157','bilg.veintkullanýmý','2009-12-03','410'),
('6055937188,','autocad 2009','2009-01-26','396'),
('605593730','ticar matematik','2010-02-02','390'),
('6055937515','algoritmaveproggiriþ','2009-07-01','306'),
('6055937522','internetprog 1','2009-09-10','284'),
('6055937683','internetprog 2','2010-01-01','515'),
('9755395661','sermayevedil','2010-01-01','144'),
('9758874095','fak.içingenel mat','2007-01-01','226');

USE OKUL_KUTUPHANESI
INSERT INTO KUTUPHANE
VALUES('Merkez','Merkez Kutuphanesi',1);

INSERT INTO KUTUPHANE
VALUES
('Zile'	,'açýldý',3),
('Turhal','kapandý',4),
('Amasya','Üyekaydý için merkez',7);

USE OKUL_KUTUPHANESI
INSERT INTO YAZARLAR
VALUES
('turgut','özseven'),
('ebubekir','yaþar'),
('h.çebi','bal'),
('fahri','özkan'),
('murat','can'),
('ötügen','senger'),
('m.ali','feyiz'),
('ramazan','inal'),
('gökhan','çuvaloðlu'),
('salih','özkan'),
('Christian','marrazi'),
('hatice','ergin'),
('armaðan','yýldýz'),
('a.rýza','özdemir'),
('s.anne','taylor'),
('paul','lunde'),
('kaitry','wilkison');
 USE OKUL_KUTUPHANESI
 INSERT INTO KATEGORILER
VALUES
('bilgisayar'),
('ekonomi'),
('eðitim'),
('edebiyat'),
('matematik'),
('psikoloji'),
('kültür'),
('muhasebe'),
('bilim'),
('diðer');

/*USE OKUL_KUTUPHANESI
INSERT INTO KITAP_KATEGORI
VALUES
('6055937515',1),
('6055937522',1),
('9755395661',2),
('6055937683',1),
('6055937157',1),
('6055937188',1),
('6055937065',8),
('605593730',5),
('9758874095',5),
('6053950899,',3),
('6053953135',6),
('6054125234',7),
('6055882334',9),
('6055813185',9),
('6051061436',10);*/


/*USE OKUL_KUTUPHANESI
INSERT INTO KITAP_YAZAR
VALUES
('6055937515',2),
('6055937522',1),
('6055937522',2),
('6055937683',1),
('6055947683',2),
('6055937157',3),
('6055937188',5),
('60559370652',7),
('6055937065',8),
('605593730',6),
('9758874095',9),
('6053950899',10),
('9755395661',11),
('6053953135',12),
('6053953135',13),
('6054125234',14),
('6055882334',15),
('6055813185',16),
('6051061436',17);*/

/*USE OKUL_KUTUPHANESI
INSERT INTO KITAP_KUTUPHANE
VALUES
(1,'6055937515',3),
(2,'6055937515',1),
(3,'6055937515',2),
(4,'6055937515',4),
(1,'6055937522',1),
(2,'6055937522',1),
(3,'6055937522,',1),
(4,'6055937683',2),
(2,'6055937683',3),
(1,'6055937683',1),
(3,'6055937157',2),
(2,'6055937157',1),
(3,'6055937188',1),
(1,'6055937188',1),
(1,'6055937065',2),
(2,'6055937065',1),
(3,'6055937065',4),
(3,'605593730',1),
(1,'605593730',1),
(1,'9758874095',2),
(3,'9758874095',1),
(2,'9758874095',6),
(4,'6053950899',1),
(3,'6053950899',1),
(3,'9755395661',1),
(4,'6053953135',2),
(1,'6053953135',1),
(3,'6054125234',1),
(2,'6054125234',2),
(1,'6055882334',1),
(4,'6055813185',1),
(3,'6055813185',2),
(2,'6051061436',1),
(3,'6051061436',1);*/

/*USE OKUL_KUTUPHANESI
INSERT INTO EMANET
VALUES
('6055937515',1,1,'2009-10-12','2009-10-17'),
('6055937683',2,2,'2009-11-15','2009-11-20'),
('6055937522',1,1,'2009-12-22',	'2009-12-24'),
('6055937065',4,2,'2012-01-01','2012-11-20'),
('6053953135',7,4,'2010-01-05','2010-01-10'),
('6054125234',2,3,'2010-01-10','2010-01-11'),
('9758874095',2,2,'2012-02-12','2010-02-14'),
('6051061436',3,3,'2010-03-21','2010-03-23'),
('6055937522',5,1,'2010-03-25','2010-03-26'),
('6055937515',6,3,'2010-04-01','2010-05-05'),
('6055937683',1,3,'2010-05-17','2010-05-20'),
('6055813185',7,5,'2010-05-17','2010-05-19'),
('6053950899',7	,4,	'2010-05-20','2010-05-22'),
('6055882334',1	,1,	'2010-06-01','2010-06-03'),
('6055937683',2	,2,'2010-06-10','2010-06-14'),
('6055937065',3	,2,	'2010-06-10','2010-06-14'),
('6055937065',8	,4,	'2010-05-02','2010-06-02'),
('6053950899',9,3,'2010-06-22','2010-06-30');*/

USE OKUL_KUTUPHANESI;
 INSERT INTO UYELER
 VALUES 
 ('Ümit', 'TEKMEN', 1,'5078819042', 'uumit380@gmail.com',1);
 
 USE OKUL_KUTUPHANESI;
 UPDATE UYELER
 SET UYE_ADI='Muhammet Ümit'
 where UYE_ADI='Ümit';
  
 USE OKUL_KUTUPHANESI;
 		INSERT INTO ADRESLER
VALUES('Kocayusuf','Osmanlý','38','Kayseri','38150','Türkiye');

UPDATE ADRESLER
 SET mahalle='Selçuklu'
 where mahalle='Osmanlý';


 	 
 USE OKUL_KUTUPHANESI;
	INSERT INTO KUTUPHANE
VALUES(15,8,'Merkez','Merkez Kutuphanesi');

UPDATE KUTUPHANE
set KUTUPHANE_ADI='belediye'
where KUTUPHANE_ADI='merkez';
 USE OKUL_KUTUPHANESI;

UPDATE EMANET
 SET TESLIM_TARIHI='2019-10-17'
 where TESLIM_TARIHI='2022-10-17';



  USE OKUL_KUTUPHANESI;
 UPDATE KITAP_YAZAR
 SET YAZAR_NO='2'
 where YAZAR_NO='18';

 
 USE OKUL_KUTUPHANESI;
INSERT INTO KATEGORILER
VALUES
('bilÝmkurgu');
 USE OKUL_KUTUPHANESI;
 UPDATE KATEGORILER
 SET KATEGORI_ADI='Bilim Kurgu'
 where KATEGORI_ADI='bilÝmkurgu';


 USE OKUL_KUTUPHANESI;
UPDATE KITAP_KUTUPHANE
SET MIKTAR='10'
WHERE MIKTAR='8';


 USE OKUL_KUTUPHANESI;
INSERT INTO KITAP_YAZAR
VALUES
('6055937515',10);
 USE OKUL_KUTUPHANESI;
UPDATE KITAP_YAZAR
SET YAZAR_NO='11'
WHERE YAZAR_NO='10';

 USE OKUL_KUTUPHANESI;
INSERT INTO KITAP_KATEGORI
VALUES
('6055937515',11);
 USE OKUL_KUTUPHANESI;
UPDATE KITAP_KATEGORI
SET KATEGORI_NO='10'
WHERE KATEGORI_NO='11';

/*3.soru*/
 USE OKUL_KUTUPHANESI;
SELECT UYE_NO
FROM UYELER
ORDER BY UYE_NO ASC;

 USE OKUL_KUTUPHANESI;
/*7.SORU*/
SELECT CONCAT(LEFT(UYE_ADI, 1), LEFT(UYE_SOYADI, 5)) AS BirlestirilmisAdSoyad
FROM UYELER
WHERE LEN(UYE_SOYADI) > 5
ORDER BY UYE_SOYADI;
 USE OKUL_KUTUPHANESI;
/*8.SORU*/
SELECT SEHIR
FROM ADRESLER 
ORDER BY SEHIR
 USE OKUL_KUTUPHANESI;
SELECT *
FROM Emanet
WHERE DATEDIFF(DAY, CONVERT(DATETIME, TESLIM_TARIHI, 121), CONVERT(DATETIME, TESLIM_TARIHI, 121)) > 180; 

USE OKUL_KUTUPHANESI;
SELECT COUNT(*) AS ÝzmirdeYasayanUyeSayisi
FROM Adresler
WHERE Ulke = 'Ýzmir';